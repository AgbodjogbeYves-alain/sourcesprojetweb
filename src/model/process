CREATE TRIGGER After_command AFTER INSERT ON COMMANDES
FOR EACH ROW
BEGIN
	SELECT RECENT := (SELECT MAX(ID_COMMANDE) FROM COMMANDES GROUP BY ID_COMMANDE)
	SELECT DISP := (SELECT V.DISPONIBILITE FROM VOLUME_MANGA V, COMMANDES C WHERE V.ID_VOLUME=C.ID_VOLUME AND C.ID_COMMANDE=RECENT);
    IF DISP>1 THEN	
		UPDATE VOLUME_MANGA
    	SET DISPONIBILITE = DISPONIBILITE - 1
		FROM VOLUME_MANGA V,COMMANDES C
    	WHERE V.ID_VOLUME = C.ID_VOLUME AND C.ID_COMMANDE = RECENT;
	END IF
END

CREATE PROCEDURE MJ_RATE(IN IDMANGA SMALLINT(6))
BEGIN 
	UPDATE MANGA SET RATE=RATE+1 WHERE ID_MANGA=IDMANGA;
END